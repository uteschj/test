<!DOCTYPE html>
<html>
  <head>
    <title>Home</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
    <script type="text/javascript" charset="utf-8" src="plugins/org.apache.cordova.file/www/File.js"></script>
<script type="text/javascript" charset="utf-8" src="plugins/org.apache.cordova.file-transfer/www/FileTransfer.js"></script>
 <!--<link rel="stylesheet" href="jquery.mobile/jquery.mobile-1.4.5.min.css" type="text/css" charset="utf-8" />-->
 <link rel="stylesheet" href="css/jquery.mobile.flatui.css" type="text/css" charset="utf-8" />
  <!--<link rel="stylesheet" href="themes/my-custom-theme.css" />-->
  <link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
 <!--<script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>-->
 <!--<script src="js/jquery.js"></script>
 <script src="jquery.mobile/jquery.mobile-1.4.5.min.js"></script>-->
 <!--<script src="js/jquery.mobile-1.4.0-rc.1.js"></script>-->
 <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css" /> 
  <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script> 
  <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script> 
 <script src="/js/jquery.lazyload.min.js" type="text/javascript"></script>
<script>
$(function() {
    handleSearch();
});
 

<script type="text/javascript" charset="utf-8" src="js/sha512.js"></script>
 <!--<script type="text/javascript" charset="utf-8" src="js/main.js"></script>-->
    <script type="text/javascript" charset="utf-8">
    var pictureSource;   // picture source
    var destinationType; // sets the format of returned value
    var pushNotification;
    var daval;
    var davall;
    // Wait for device API libraries to load
    //
    document.addEventListener("deviceready",onDeviceReady,false);
    // device APIs are available
    //
    function onDeviceReady() {
        pictureSource=navigator.camera.PictureSourceType;
        destinationType=navigator.camera.DestinationType;
        //$("#loginForm").on("submit",handleLogin);
        //echoSessionID();
        navigator.geolocation.getCurrentPosition(sendCord);
        pushNotification = window.plugins.pushNotification;
        if ( device.platform == 'android' || device.platform == 'Android' )
{
    pushNotification.register(
        successHandler,
        errorHandler, {
            "senderID":"7160911895",
            "ecb":"onNotificationGCM"
        });
}
else
{
    pushNotification.register(
        tokenHandler,
        errorHandler, {
            "badge":"true",
            "sound":"true",
            "alert":"true",
            "ecb":"onNotificationAPN"
        });
}

    getStatusSearchHistory();
    }
    
    
    // result contains any message sent from the plugin call
function successHandler (result) {
    //alert('result = ' + result);
}

// result contains any error description text returned from the plugin call
function errorHandler (error) {
    alert('error = ' + error);
}
function onNotificationGCM(e) {
    $("#app-status-ul").append('<li>EVENT -> RECEIVED:' + e.event + '</li>');

    switch( e.event )
    {
    case 'registered':
        if ( e.regid.length > 0 )
        {
            $("#app-status-ul").append('<li>REGISTERED -> REGID:' + e.regid + "</li>");
            // Your GCM push server needs to know the regID before it can push to this device
            // here is where you might want to send it the regID for later use.
            console.log("regID = " + e.regid);
            //alert("regID = " + e.regid);
            davall = " " + e.regid;
           
              var sesson = window.localStorage["username"];
     
     //console.log(session);
     var formData = {email:sesson,ppushid:davall}; //Array 
 	//alert(davall);
$.ajax({
    url : "https://totalsupply1.com/log_in/process_push.php",
    type: "POST",
    data : formData,
    success: function(data, textStatus, jqXHR)
    {
    	//alert(davall);
        //alert(data);
       
        
        
       
    },
    error: function (jqXHR, textStatus, errorThrown)
    {
 //alert('Loggin FAILd');
    }
});

            //googlepush(davall);
            //alert(davall);
            
           
           // googlepush(davall);
           
        }
    break;

    case 'message':
        // if this flag is set, this notification happened while we were in the foreground.
        // you might want to play a sound to get the user's attention, throw up a dialog, etc.
        if ( e.foreground )
        {
            $("#app-status-ul").append('<li>--INLINE NOTIFICATION--' + '</li>');

            // if the notification contains a soundname, play it.
            var my_media = new Media("/android_asset/www/"+e.soundname);
            my_media.play();
        }
        else
        {  // otherwise we were launched because the user touched a notification in the notification tray.
            if ( e.coldstart )
            {
                $("#app-status-ul").append('<li>--COLDSTART NOTIFICATION--' + '</li>');
            }
            else
            {
                $("#app-status-ul").append('<li>--BACKGROUND NOTIFICATION--' + '</li>');
            }
        }

        $("#app-status-ul").append('<li>MESSAGE -> MSG: ' + e.payload.message + '</li>');
        $("#app-status-ul").append('<li>MESSAGE -> MSGCNT: ' + e.payload.msgcnt + '</li>');
    break;

    case 'error':
        $("#app-status-ul").append('<li>ERROR -> MSG:' + e.msg + '</li>');
    break;

    default:
        $("#app-status-ul").append('<li>EVENT -> Unknown, an event was received and we do not know what it is</li>');
    break;
  }
}

    // Called when a photo is successfully retrieved
    //
     function getStatusSearchHistory() {

	searchHistoryReload();
	rochOrdersReload();
	webOrdersReload()
 

 	
 	setTimeout("getStatusSearchHistory()",40000);
 	
}
function sendCord(pos) {
	//alert(pos.coords.latitude);
	//alert(pos.coords.longitude);
   var lolat = pos.coords.latitude;
   var lolong = pos.coords.longitude;
   
   var loemail = window.localStorage["username"];
   var formData = {email:loemail,long:lolong,lat:lolat}; //Array 
 
$.ajax({
    url : "https://totalsupply1.com/log_in/process_location.php",
    type: "POST",
    data : formData,
    success: function(data, textStatus, jqXHR)
    {
        //alert(data);
    },
    error: function (jqXHR, textStatus, errorThrown)
    {
    	//alert(errorThrown);
    }
});
}
function googlepush(pushiid) {
    console.log("click");
     var sesson = 'justin';
     alert(session);
     console.log(session);
      var formData = {email:sesson,ppushid:pushiid}; //Array 
 
$.ajax({
    url : "https://totalsupply1.com/log_in/process_push.php",
    type: "POST",
    data : formData,
    success: function(data, textStatus, jqXHR)
    {
        alert(data);
       
        
        
       
    },
    error: function (jqXHR, textStatus, errorThrown)
    {
 alert('Loggin FAILd');
    }
});
    
    return false;
}
    function uploadPhoto(imageURI) {
      alert('start of uploadPhto');
        var options = new FileUploadOptions();
        options.fileKey="file";
        options.fileName=imageURI.substr(imageURI.lastIndexOf('/')+1);
        options.mimeType="image/jpeg";
        var params = new Object();
        params.value1 = "test";
        params.value2 = "param";
        options.params = params;
        options.chunkedMode = false;
        var ft = new FileTransfer();
        ft.upload(imageURI, "http://192.168.254.15/uploadtester.php", win, fail, options);
    }
    function win(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        alert(r.response);
    }
    function fail(error) {
        alert("An error has occurred: Code = " = error.code);
    }
    
    function checkPreAuth() {
    var form = $("#loginForm");
    if(window.localStorage["username"] != undefined && window.localStorage["password"] != undefined) {
        $("#username", form).val(window.localStorage["username"]);
        $("#password", form).val(window.localStorage["password"]);
        handleLogin();
    }
}
function searchHistoryReload() {
    console.log("click");
     var session = window.localStorage.getItem("webSessionID");
     //alert(session);
     console.log(session);
      var formData = {sessionID:session}; //Array 
 
$.ajax({
    url : "https://totalsupply1.com/log_in/AppAutoReloadHistory.php",
    type: "POST",
    data : formData,
    success: function(data, textStatus, jqXHR)
    {
        //alert(data);
        if (data == "sessionExpire") {
        	window.location.replace('index.html');
        }
        if (data != "") {
        $('#searchHistory').html(data);
	}
},
    error: function (jqXHR, textStatus, errorThrown)
    {
 alert('Loggin FAILd');
    }
});
    return false;
}

function webOrdersReload() {
    console.log("click");
     var session = window.localStorage.getItem("webSessionID");
     //alert(session);
     console.log(session);
      var formData = {sessionID:session}; //Array 
 
$.ajax({
    url : "https://totalsupply1.com/log_in/AppAutoReloadQuotes.php",
    type: "POST",
    data : formData,
    success: function(data, textStatus, jqXHR)
    {
        //alert(data);
        if (data == "sessionExpire") {
        	window.location.replace('index.html');
        }
        if (data != "<table border='1'></table>") {
        $('#webOrder').html(data);
        }
        
       
    },
    error: function (jqXHR, textStatus, errorThrown)
    {
 alert('Loggin FAILd');
    }
});
    
    return false;
}
    

function rochOrdersReload() {
    console.log("click");
     var session = window.localStorage.getItem("webSessionID");
     //alert(session);
     console.log(session);
      var formData = {sessionID:session}; //Array 
 
$.ajax({
    url : "https://totalsupply1.com/log_in/AppAutoReloadOrders.php",
    type: "POST",
    data : formData,
    success: function(data, textStatus, jqXHR)
    {
        //alert(data);
        if (data == "sessionExpire") {
        	window.location.replace('index.html');
        }
        if (data != "<table border='1'></table>") {
        $('#rochOrder').html(data);
        }
       
    },
    error: function (jqXHR, textStatus, errorThrown)
    {
 alert('Loggin FAILd');
    }
});
    
    return false;
}
    



    </script>
  </head>
  <body onload="init()">

<div data-theme="a" data-form="ui-body-b" class="ui-body ui-body-b ui-corner-all" data-role="page">

    <div data-role="panel" id="panel" data-position="right" data-theme="a" data-display="push"><ul data-role="listview" data-inset="true" class="ui-listview ui-listview-inset ui-corner-all ui-shadow">
            <li data-role="list-divider" data-theme="a" data-swatch="a" data-form="ui-bar-a" role="heading" class="ui-li-divider ui-bar-a ui-first-child">List Header</li>
            <li data-form="ui-body-a" data-swatch="a" data-theme="a" class="ui-li-static ui-body-a">Read-only list item</li>
            <li class="ui-last-child"><a class="ui-btn-a ui-btn ui-btn-icon-right ui-icon-carat-r" data-form="ui-btn-up-a" data-swatch="a" data-theme="a" href="#">Linked list item</a></li>
		</ul></div>

    <div data-role="header">
      <a data-iconpos="notext" data-role="button" data-icon="home" title="Home" ontouchstart="window.location.replace('home.html');">Home</a>
      <h1>Home</h1>
      <a data-iconpos="notext" href="#panel" data-role="button" data-icon="grid"></a>
    </div>

    <div data-role="content">    
<div class="app-status-ul">
	
</div>
        <button ontouchstart="window.location.replace('search.html');">Search</button>
       
        <h1>Rochester Orders</h1>
        <div id="rochOrder">
        </div>
        <h1>Web Orders</h1>
        <div id="webOrder">
        </div>
        <h1>Search History</h1>
        <div id="searchHistory" style="font-size: 10px;">
        </div>
        
        
        
        </div>
        
    
    
    </div>

    <div data-role="footer">
        <h4>&copy; Utesch Enterprises</h4>
    </div>

</div>

<script>
$("#loginPage").live("pageinit", function(e) {
        checkPreAuth();
    });
</script>
  </body>
</html>
