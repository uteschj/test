<!DOCTYPE html>
<html>
  <head>
    <title>Item</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
    <script type="text/javascript" charset="utf-8" src="plugins/org.apache.cordova.file/www/File.js"></script>
<script type="text/javascript" charset="utf-8" src="plugins/org.apache.cordova.file-transfer/www/FileTransfer.js"></script>
 <!--<link rel="stylesheet" href="jquery.mobile/jquery.mobile-1.4.5.min.css" type="text/css" charset="utf-8" />-->
 <link rel="stylesheet" href="css/jquery.mobile.flatui.css" type="text/css" charset="utf-8" />
  <!--<link rel="stylesheet" href="themes/my-custom-theme.css" />-->
  <link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
 <!--<script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>-->
 <!--<script src="js/jquery.js"></script>
 <script src="jquery.mobile/jquery.mobile-1.4.5.min.js"></script>-->
 <!--<script src="js/jquery.mobile-1.4.0-rc.1.js"></script>-->
 <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile.structure-1.4.5.min.css" /> 
  <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script> 
  <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script> 
 <script src="/js/jquery.lazyload.min.js" type="text/javascript"></script>

<script type="text/javascript" charset="utf-8" src="js/sha512.js"></script>
 <!--<script type="text/javascript" charset="utf-8" src="js/main.js"></script>-->
    <script type="text/javascript" charset="utf-8">
    var pictureSource;   // picture source
    var destinationType; // sets the format of returned value
    // Wait for device API libraries to load
    //
    document.addEventListener("deviceready",onDeviceReady,false);
    // device APIs are available
    //
    var jssearch;
    var jspage;
    var jsitem;
    function onDeviceReady() {
        pictureSource=navigator.camera.PictureSourceType;
        destinationType=navigator.camera.DestinationType;
        //$("#loginForm").on("submit",handleLogin);
        //echoSessionID();
        jsitem = getUrlParameter('item');
        jssearch = getUrlParameter('search');
        jspage = getUrlParameter('page');
        //alert(jssearch);
        //alert(jspage);
        //alert(jsitem);
        getItem(jsitem);
        
    }
    // Called when a photo is successfully retrieved
    //
function onSuccess(imageURI) {
    var image = document.getElementById('myImage');
    //image.src = imageURI;
    alert(imageURI);
}
function clearCache() {
    navigator.camera.cleanup();
}
function onFail(message) {
    alert('Failed because: ' + message);
}


    function takepicture(picturecode) {
      //alert('takepicture');
      if (picturecode == "zero")
      {

        navigator.camera.getPicture(uploadPhoto, onFail, { quality: 100,
        encodingType: navigator.camera.EncodingType.JPEG,
        destinationType: destinationType.FILE_URI,
        correctOrientation: false,
        saveToPhotoAlbum: true });

      }
      else if (picturecode == "A") {
        // Retrieve image file location from specified source
        navigator.camera.getPicture(uploadPhotoA, onFail, { quality: 100,
        encodingType: navigator.camera.EncodingType.JPEG,
        destinationType: destinationType.FILE_URI,
        correctOrientation: false,
        saveToPhotoAlbum: true });
      }
      else if (picturecode == "B") {
        // Retrieve image file location from specified source
       navigator.camera.getPicture(uploadPhotoB, onFail, { quality: 100,
        encodingType: navigator.camera.EncodingType.JPEG,
        destinationType: destinationType.FILE_URI,
        correctOrientation: false,
        saveToPhotoAlbum: true });
      }
      else if (picturecode == "C") {
        // Retrieve image file location from specified source
        navigator.camera.getPicture(uploadPhotoC, onFail, { quality: 100,
        encodingType: navigator.camera.EncodingType.JPEG,
        destinationType: destinationType.FILE_URI,
        correctOrientation: false,
        saveToPhotoAlbum: true });
      }
      else if (picturecode == "D") {
        // Retrieve image file location from specified source
        navigator.camera.getPicture(uploadPhotoD, onFail, { quality: 100,
        encodingType: navigator.camera.EncodingType.JPEG,
        destinationType: destinationType.FILE_URI,
        correctOrientation: false,
        saveToPhotoAlbum: true });
      }
      else if (picturecode == "E") {
        // Retrieve image file location from specified source
        navigator.camera.getPicture(uploadPhotoE, onFail, { quality: 100,
        encodingType: navigator.camera.EncodingType.JPEG,
        destinationType: destinationType.FILE_URI,
        correctOrientation: false,
        saveToPhotoAlbum: true });
      }
        
        
    }
    function uploadPhoto(imageURI) {
     // clearCache();
      var options = new FileUploadOptions();
        options.fileKey="file";
        options.fileName=imageURI.substr(imageURI.lastIndexOf('/')+1);
        options.mimeType="image/jpeg";
        var params = new Object();
        params.itemNumber = jsitem;
        params.Delim = "None";
        options.params = params;
        options.headers = {
            Connection: "close"
            
        }
        options.chunkedMode = false;
        var ft = new FileTransfer();
        ft.upload(imageURI, "http://192.168.254.15/uploadtester.php", win, fail, options);
    
    
    }
    function uploadPhotoA(imageURI) {
     // clearCache():
      //alert('start of uploadPhto');
        var options = new FileUploadOptions();
        options.fileKey="file";
        options.fileName=imageURI.substr(imageURI.lastIndexOf('/')+1);
        options.mimeType="image/jpeg";
        var params = new Object();
        params.itemNumber = jsitem;
        params.Delim = "A";
        options.params = params;
        options.headers = {
            Connection: "close"
            
        }
        options.chunkedMode = false;
        var ft = new FileTransfer();
        ft.upload(imageURI, "http://192.168.254.15/uploadtester.php", win, fail, options);
    }
    function uploadPhotoB(imageURI) {
      alert('start of uploadPhto');
        var options = new FileUploadOptions();
        options.fileKey="file";
        options.fileName=imageURI.substr(imageURI.lastIndexOf('/')+1);
        options.mimeType="image/jpeg";
        var params = new Object();
        params.itemNumber = jsitem;
        params.Delim = "B";
        options.params = params;
        options.headers = {
            Connection: "close"
            
        }
        options.chunkedMode = false;
        var ft = new FileTransfer();
        ft.upload(imageURI, "http://192.168.254.15/uploadtester.php", win, fail, options);
    }
    function uploadPhotoC(imageURI) {
      alert('start of uploadPhto');
        var options = new FileUploadOptions();
        options.fileKey="file";
        options.fileName=imageURI.substr(imageURI.lastIndexOf('/')+1);
        options.mimeType="image/jpeg";
        var params = new Object();
        params.itemNumber = jsitem;
        params.Delim = "C";
        options.params = params;
        options.headers = {
            Connection: "close"
            
        }
        options.chunkedMode = false;
        var ft = new FileTransfer();
        ft.upload(imageURI, "http://192.168.254.15/uploadtester.php", win, fail, options);
    }
    function uploadPhotoD(imageURI) {
      alert('start of uploadPhto');
        var options = new FileUploadOptions();
        options.fileKey="file";
        options.fileName=imageURI.substr(imageURI.lastIndexOf('/')+1);
        options.mimeType="image/jpeg";
        var params = new Object();
        params.itemNumber = jsitem;
        params.Delim = "D";
        options.params = params;
        options.headers = {
            Connection: "close"
            
        }
        options.chunkedMode = false;
        var ft = new FileTransfer();
        ft.upload(imageURI, "http://192.168.254.15/uploadtester.php", win, fail, options);
    }
    function uploadPhotoE(imageURI) {
      alert('start of uploadPhto');
        var options = new FileUploadOptions();
        options.fileKey="file";
        options.fileName=imageURI.substr(imageURI.lastIndexOf('/')+1);
        options.mimeType="image/jpeg";
        var params = new Object();
        params.itemNumber = jsitem;
        params.Delim = "E";
        options.params = params;
        options.headers = {
            Connection: "close"
            
        }
        options.chunkedMode = false;
        var ft = new FileTransfer();
        ft.upload(imageURI, "http://192.168.254.15/uploadtester.php", win, fail, options);
    }
    function win(r) {
        console.log("Code = " + r.responseCode);
        console.log("Response = " + r.response);
        console.log("Sent = " + r.bytesSent);
        alert(r.response);
    }
    function fail(error) {
        alert("An error has occurred: Code = " = error.code);
    }
    
    function checkPreAuth() {
    var form = $("#loginForm");
    if(window.localStorage["username"] != undefined && window.localStorage["password"] != undefined) {
        $("#username", form).val(window.localStorage["username"]);
        $("#password", form).val(window.localStorage["password"]);
        handleLogin();
    }
}
function getUrlParameter(sParam)
{
    var sPageURL = window.location.search.substring(1);
    var sURLVariables = sPageURL.split('&');
    for (var i = 0; i < sURLVariables.length; i++) 
    {
        var sParameterName = sURLVariables[i].split('=');
        if (sParameterName[0] == sParam) 
        {
            return sParameterName[1];
        }
    }
}  

function getItem(s) {
  //alert(s + ' ' + pagenumber);
     var session = window.localStorage.getItem("webSessionID");
     console.log(session);
      var formData = {sessionID:session,item:s}; //Array 
$.ajax({
    url : "https://totalsupply1.com/log_in/AppItem.php",
    type: "POST",
    data : formData,
    success: function(data, textStatus, jqXHR)
    {
      //alert(data);
      if (data == "sessionExpire") {
        	window.location.replace('index.html');
        }
        $('#itemlist').html(data);
        $("img.lazy").lazyload({
    threshold : 200
});
    },
    error: function (jqXHR, textStatus, errorThrown)
    {
 alert('Loggin FAILd');
    }
});
    return false;
}

function GoBack() {
  window.location.replace('search.html?search='+jssearch+'&page='+jspage);
}

    </script>
  </head>
  <body onload="init()">

<div data-role="page">

    <div data-role="panel" id="panel" data-position="right" data-theme="a" data-display="push"></div>

    <div data-role="header">
      <a data-iconpos="notext" data-role="button" data-icon="home" title="Home" ontouchstart="window.location.replace('home.html');">Home</a>
      <h1>Search</h1>
      <a data-iconpos="notext" href="#panel" data-role="button" data-icon="flat-menu"></a>
    </div>

    <div data-role="content">
        <button ontouchstart="GoBack(); return false;">Back</button>
       
        <div id="itemlist">
        </div>
        </div>
        
    
    
    </div>

    <div data-role="footer">
        <h4>&copy; Utesch Enterprises</h4>
    </div>

</div>

<script>
$("#loginPage").live("pageinit", function(e) {
        checkPreAuth();
    });
</script>
  </body>
</html>
