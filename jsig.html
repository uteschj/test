<!DOCTYPE html>
<html>
  <head>
    <title>Signature</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
    <script type="text/javascript" charset="utf-8" src="phonegap.js"></script>
    <script type="text/javascript" charset="utf-8" src="plugins/org.apache.cordova.file/www/File.js"></script>
<script type="text/javascript" charset="utf-8" src="plugins/org.apache.cordova.file-transfer/www/FileTransfer.js"></script>
 <!--<link rel="stylesheet" href="jquery.mobile/jquery.mobile-1.4.5.min.css" type="text/css" charset="utf-8" />-->
 <link rel="stylesheet" href="css/jquery.mobile.flatui.css" type="text/css" charset="utf-8" />
  <!--<link rel="stylesheet" href="themes/my-custom-theme.css" />-->
  <link rel="stylesheet" href="themes/jquery.mobile.icons.min.css" />
 <!--<script type="text/javascript" src="js/jquery-2.1.1.min.js"></script>-->
 <!--<script src="js/jquery.js"></script>
 <script src="jquery.mobile/jquery.mobile-1.4.5.min.js"></script>-->
 <!--<script src="js/jquery.mobile-1.4.0-rc.1.js"></script>-->
 
 <link rel="stylesheet" href="js/jquery.mobile.structure-1.4.5.min.css" /> 
  <script src="js/jquery-1.11.1.min.js"></script> 
  <script src="js/jquery.mobile-1.4.5.min.js"></script> 
 <script src="js/jquery.lazyload.min.js" type="text/javascript"></script>

<script type="text/javascript" charset="utf-8" src="js/sha512.js"></script>
 <script type="text/javascript" charset="utf-8" src="js/main.js"></script>
 <!--<script type="text/javascript" charset="utf-8" src="js/main.js"></script>-->
    <script type="text/javascript" charset="utf-8">
    var pictureSource;   // picture source
    
    // Wait for device API libraries to load
    //
    document.addEventListener("deviceready",onDeviceReady,false);
    // device APIs are available
    //
    var db;
    function onDeviceReady() {
       StatusBar.overlaysWebView(false);
       
       
	db = window.sqlitePlugin.openDatabase({name: "TRS_Portal.db", location: 1});
	
	db.transaction(function(tx) {
	tx.executeSql('CREATE TABLE IF NOT EXISTS customer_sig (id integer primary key, sig_data text, doc_num text, note text, gps_cord text, Timestamp DATETIME DEFAULT CURRENT_TIMESTAMP)');
	});
	
	
	var fromLoggin = getUrlParameter('loggedin');
	if (fromLoggin === 'yes') {
	pushRegistration();
	 navigator.geolocation.getCurrentPosition(sendCord);
	}
	
	//alert(document.referrer);
    }
    
    function recordsig(){
    	var datapair = $("#signature").jSignature("getData", "svgbase64");
    	var datapairstring = datapair[0] + "," + datapair[1];
    	var doc = $("#doc", form).val();
    	var note = $("#note", form).val();
    	db.transaction(function(tx) {
   
    tx.executeSql("INSERT INTO customer_sig (sig_data, doc_num, note, gps_cord) VALUES (?,?,?,?)", [datapairstring, doc, note, "11"]);


	});
    }
    function getsig(){
    	alert("getting doc");
    	db.transaction(function(tx) {
        tx.executeSql("select doc_num from customer_sig LIMIT 1;", [], function(tx, res) {
          
          alert("res.rows.item(0).doc_num: " + res.rows.item(0).doc_num);
        });
    });
    }
    
    </script>
  </head>
  <body onload="init()">

<div data-role="page">

    <div data-role="panel" id="panel" data-position="right" data-theme="a" data-display="push"><ul data-role="listview" data-inset="true" class="ui-listview ui-listview-inset ui-corner-all ui-shadow">
            <!--<li data-role="list-divider" data-theme="a" data-swatch="a" data-form="ui-bar-a" role="heading" class="ui-li-divider ui-bar-a ui-first-child">List Header</li>
            <li data-form="ui-body-a" data-swatch="a" data-theme="a" class="ui-li-static ui-body-a">Read-only list item</li>-->
            <li class="ui-last-child"><a class="ui-btn-a ui-btn ui-btn-icon-right ui-icon-carat-r" data-form="ui-btn-up-a" data-swatch="a" data-theme="a" href="#" ontouchstart="window.location.replace('settings.html');">App Settings</a></li>
	    <li class="ui-last-child"><a class="ui-btn-a ui-btn ui-btn-icon-right ui-icon-carat-r" data-form="ui-btn-up-a" data-swatch="a" data-theme="a" href="#" ontouchstart="window.location.replace('jsig.html');">Signature</a></li>
	    <li class="ui-last-child"><a class="ui-btn-a ui-btn ui-btn-icon-right ui-icon-carat-r" data-form="ui-btn-up-a" data-swatch="a" data-theme="a" href="#">Shopping Cart</a></li>
			
		</ul></div>

    <div data-role="header">
      <a data-iconpos="notext" data-role="button" data-icon="home" title="Home" ontouchstart="window.location.replace('home.html');">Home</a>
      <h1>Signature</h1>
      <a data-iconpos="notext" href="#panel" data-role="button" data-icon="grid"></a>
    </div>

    <div data-role="content">    
<div class="app-status-ul">
	
</div>
        <form id="searchForm" onsubmit="return false;">
       <div data-role="fieldcontain" class="ui-hide-label" >
            <label for="doc">Doc Number:</label>
            Doc: <input type="text" name="doc" id="doc" value="" />
        
        
	<script src="jsig/jSignature.min.js"></script>
	<div id="signature"></div>
	<script>
	    $(document).ready(function() {
	        $("#signature").jSignature()
	    })
	</script>
	<label for="note">Note:</label>
            Name: <input type="text" name="note" id="note" value="" />
        </div>
        <button type="button" ontouchstart="recordsig(); return false;">Save</button>
        </form>
        <br><br><br><br><br><br>
        <button type="button" ontouchstart="$('#signature').jSignature('reset'); return false;">Reset</button>
        <button type="button" ontouchstart="getsig(); return false;">dump</button>
        </div>
        
    
    
    </div>

    <div data-role="footer">
        <h4>&copy; Utesch Enterprises</h4>
    </div>

</div>

<script>
$("#loginPage").live("pageinit", function(e) {
        checkPreAuth();
    });
</script>
  </body>
</html>
